# チャットbot レート制限・収益化計画

## 概要
Claude 3.5 Haikuモデルを採用し、AdSense収益で黒字運営を実現する持続可能なAIチャットシステム

## 1. コスト構造

### Claude 3.5 Haiku料金
- 入力: $1/1Mトークン
- 出力: $5/1Mトークン  
- キャッシュ: $0.10/1Mトークン
- **1回あたり: 約¥0.25**

### 月間コスト予測
| ユーザー/日 | メッセージ/月 | 月間コスト |
|------------|--------------|-----------|
| 100 | 15,000 | ¥3,750 |
| 500 | 75,000 | ¥18,750 |
| 1,000 | 150,000 | ¥37,500 |
| 2,000 | 300,000 | ¥75,000 |

## 2. レート制限実装

### 制限値設定
```typescript
MAX_MESSAGES_PER_SESSION: 20  // セッション上限
MAX_MESSAGES_PER_HOUR: 10     // 時間制限
MAX_MESSAGES_PER_DAY: 30      // 日次制限
MAX_INPUT_LENGTH: 500         // 文字数制限
MAX_OUTPUT_TOKENS: 800        // 出力制限
COOLDOWN_SECONDS: 10          // クールダウン
```

### 実装箇所
- **フロントエンド**: `claudeApiClient.ts` - localStorage管理
- **バックエンド**: `chat-proxy.php` - PHPセッション管理
- **UI**: `CareerChatBot.vue` - 使用状況表示

## 3. 収益化計画

### AdSense収益予測
- RPM（1000PVあたり）: ¥300（現実的）
- 1ユーザーあたりPV: 10ページ/日

### 損益分岐点
- **RPM ¥300**: 125ユーザー/日で黒字化
- **RPM ¥500**: 75ユーザー/日で黒字化

### 収支シミュレーション
```
初期（100ユーザー/日）:
- AdSense: ¥9,000/月
- コスト: ¥3,750/月
- 利益: +¥5,250/月 ✅

成長期（500ユーザー/日）:
- AdSense: ¥45,000/月
- コスト: ¥18,750/月
- 利益: +¥26,250/月 ✅

拡大期（1,000ユーザー/日）:
- AdSense: ¥90,000/月
- コスト: ¥37,500/月
- 利益: +¥52,500/月 ✅
```

## 4. 年間予測

### 1年目収支計画
```
1-3月: 100ユーザー/日 → +¥5,000/月
4-6月: 300ユーザー/日 → +¥15,000/月
7-9月: 500ユーザー/日 → +¥26,000/月
10-12月: 800ユーザー/日 → +¥40,000/月

年間利益: +¥123,000
```

## 5. コスト最適化戦略

### API使用量削減
1. **キャッシュ活用**: よくある質問は定型回答
2. **段階的エスカレーション**: 
   - 簡単な質問 → 定型文
   - 通常の質問 → Haiku API
   - 複雑な質問 → Sonnet API（将来）

### レート制限の効果
- 過度な使用防止
- サーバー負荷軽減
- コスト予測可能性向上

## 6. 技術実装詳細

### フロントエンド（TypeScript）
```typescript
// セッション管理
localStorage.setItem('chatbot_session', JSON.stringify({
  messageCount: 0,
  hourlyMessages: [],
  dailyMessages: [],
  lastMessageTime: 0
}));

// UI表示
- プログレスバー
- 残りメッセージ数
- クールダウンタイマー
```

### バックエンド（PHP）
```php
// セッション管理
session_start();
$_SESSION['chat_session'] = [
  'message_count' => 0,
  'hourly_messages' => [],
  'daily_messages' => [],
  'last_message_time' => 0
];

// レート制限チェック
- クールダウン確認
- 時間/日次制限確認
- エラーレスポンス
```

## 7. 将来の拡張計画

### Phase 1（現在）
- Haikuモデル採用
- 基本レート制限
- AdSense収益化

### Phase 2（6ヶ月後）
- ユーザー登録機能
- プレミアムプラン（制限緩和）
- Sonnetモデル選択可能

### Phase 3（1年後）
- API使用量ダッシュボード
- カスタムプロンプト
- 企業向けAPI提供

## 8. リスク管理

### リスク要因と対策
- **AdSense審査落ち** → 他の広告ネットワーク検討
- **RPM低下** → コンテンツ品質向上、SEO強化
- **API使用量急増** → レート制限強化、キャッシュ拡充

### 安全マージン
- 最悪ケース（RPM ¥150）でも300ユーザー/日で収支トントン
- レート制限により予算超過を防止

## 9. モニタリング指標

### 追跡すべきKPI
- 日次アクティブユーザー数
- API使用量（メッセージ数）
- AdSense RPM
- エラー率
- ユーザー満足度

### アラート設定
- API使用量が予算の80%到達
- エラー率が5%超過
- RPMが¥200以下に低下

## 10. 実装ステータス

### 完了済み ✅
- Claude 3.5 Haiku統合
- レート制限実装（クライアント/サーバー）
- 使用状況UI表示
- セキュリティ対策

### 今後の作業
- AdSense広告配置最適化
- キャッシュシステム構築
- 分析ダッシュボード作成
- A/Bテスト環境構築

---
最終更新: 2025年8月15日
担当: Claude Code + serena MCP