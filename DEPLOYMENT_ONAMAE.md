# お名前.com共用サーバー デプロイメントガイド

このドキュメントでは、Vue.js SPAアプリケーション（ため職）をお名前.com共用サーバーにデプロイする手順を説明します。

## 前提条件

- Node.js 18以上がローカル環境にインストールされている
- お名前.com共用サーバーのFTPアクセス情報
- Claude API Key

## デプロイ手順

### 1. ローカル環境でビルド実行

```bash
# プロジェクトディレクトリに移動
cd my-vue-app

# 依存関係をインストール（初回のみ）
npm install

# 本番用ビルドを実行
npm run build
```

### 2. 必要ファイルの準備

ビルド完了後、以下のファイル・フォルダが必要です：

```
my-vue-app/
├── dist/           # ビルド結果（全ファイル）
├── public/
│   ├── .htaccess   # SPA対応設定
│   └── api/
│       └── chat-proxy.php  # Claude APIプロキシ
└── .env            # 環境変数（APIキー含む）
```

### 3. サーバーファイル配置

FTPクライアントを使用して以下の通りアップロード：

#### 3-1. ルートディレクトリ
`dist/` フォルダ内の全ファイルをサーバーのルートディレクトリ（public_html/）にアップロード

#### 3-2. 必須設定ファイル
- `public/.htaccess` → `public_html/.htaccess`
- `public/api/chat-proxy.php` → `public_html/api/chat-proxy.php`
- `.env` → `public_html/.env`

### 4. ファイル権限設定

お名前.comのファイルマネージャーまたはFTPクライアントで以下の権限を設定：

```
.htaccess         → 644
api/              → 755
api/chat-proxy.php → 644
.env              → 600 (重要: セキュリティのため)
```

### 5. PHP設定確認

お名前.comの管理画面で以下を確認：
- PHPバージョン: 7.4以上
- cURL拡張機能: 有効
- allow_url_fopen: 有効

## APIキー設定

### 環境変数ファイル（.env）
```env
VITE_CLAUDE_API_KEY=sk-ant-api03-your_actual_api_key_here
```

### セキュリティ注意事項
- `.env`ファイルの権限は必ず600に設定
- APIキーは絶対に公開リポジトリにコミットしない
- 定期的にAPIキーをローテーションする

## 動作確認

### 1. 基本動作チェック
- `https://your-domain.com/` → ホームページが表示される
- `https://your-domain.com/diagnosis` → 診断ページが表示される
- `https://your-domain.com/chat` → チャットページが表示される

### 2. APIチェック
- チャットページでメッセージを送信
- レスポンスが正常に返される

### 3. SPA動作チェック
- ページ遷移が正常に動作する
- 直接URLアクセスでも表示される
- ブラウザの戻る・進むボタンが正常に動作する

## トラブルシューティング

### 500 Internal Server Error
- `.htaccess`の構文エラーをチェック
- PHP構文エラーをチェック
- エラーログを確認（お名前.com管理画面）

### API呼び出しエラー
- `.env`ファイルの存在と権限をチェック
- APIキーの有効性をチェック
- PHP cURL拡張機能の有効性をチェック

### SPA動作不良
- `.htaccess`のRewriteルールをチェック
- ビルドファイルの完全性をチェック

## 更新手順

1. ローカルで修正・テスト
2. `npm run build`でビルド実行
3. `dist/`フォルダの内容をサーバーにアップロード
4. 必要に応じて設定ファイルも更新

## バックアップ

定期的に以下をバックアップ：
- 全サイトファイル
- `.env`ファイル
- データベース（今後追加される場合）

---

**注意**: このデプロイメント手順は2025年8月5日時点の情報です。お名前.comのサービス仕様変更により手順が変わる可能性があります。